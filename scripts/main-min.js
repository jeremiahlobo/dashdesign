function loadScript(a,t){var e=document.createElement("script");e.type="text/javascript",t&&(e.onload=t),document.getElementsByTagName("head")[0].appendChild(e),e.src=a}function initialize(){geocoder=new google.maps.Geocoder}var PF=PF||{};PF.filter={},PF.forms={},PF.helper={},PF.ui={},PF.mapUI={},PF.platform={},PF.filter={showAll:function(){featureLayer.setFilter(function(){return!0})},showNone:function(){featureLayer.setFilter(function(){return!1})},by:function(a,t){featureLayer.setFilter(function(e){return e.properties[a]===t})},within:function(a,t){featureLayer.setFilter(function(e){return e.properties[a]in t})},makeList:function(a,t){for(var e=[],i=0;i<a.length;i++){var n=a[i].properties[t];indexOf.call(e,n)<0&&e.push(n)}},findNearest:function(a,t){var e=[],i=L.circle([t.getLatLng().lat,t.getLatLng().lng],e[a-1]);return featureLayer.eachLayer(function(a){e.push(t.getLatLng().distanceTo(a.getLatLng()))}),i}},PF.helper={compareNumber:function(a,t){return!Number.isNan(a)&&!Number.isNan(t)&&a-t}},PF.forms={ajaxPostHandler:function(a,t,e){$(".spinner").show(),$.ajax({url:baseURL+a,type:"POST",data:t,success:function(a){e(a),$(".spinner").hide()},error:function(a,t){$(".spinner").hide(),console.log(t)}})},validation:{}},PF.userActions={search:function(){switch(this.getAttribute("class")){case"searchChurch":postalCode?PF.lonlat.centreOnMap(postalCode):(PF.ui.panels.dig(),PF.forms.ajaxPostHandler("app/search",{parishName:parishName,cityID:cityID},PF.userActions.list.church));break;case"searchClergy":PF.ui.panels.dig(),PF.forms.ajaxPostHandler("app/search",{clergyName:clergyName,positionClergyID:positionClergyID},PF.userActions.list.clergy);break;case"searchMass":PF.ui.panels.dig(),PF.forms.ajaxPostHandler("app/search",{massTypeID:massTypeID,DayOfWeek:DayOfWeek.get(),StartTime:StartTime},PF.userActions.list.mass);break}},list:{church:function(a){$(".panel__list").empty(),$(".panel__list").html(a),$("#churchlist > li").click(function(){PF.ui.panels.dig(),console.log("here"),PF.forms.ajaxPostHandler("app/information/parishDetails",{idParish:this.id},PF.userActions.information.church),PF.mapUI.flyToPin($(this).data("longitude"),$(this).data("latitude"),$(this).data("cid"))})},clergy:function(a){$(".panel__list").empty(),$(".panel__list").html(a),$("#clergylist > li").click(function(){console.log($(this).data("idparish")),PF.mapUI.boundsOnPID($(this).data("idparish")),PF.ui.panels.dig(),PF.forms.ajaxPostHandler("app/information/clergyDetails",{idClergy:this.id},PF.userActions.information.clergy)})},mass:function(a){$(".panel__list").empty(),$(".panel__list").html(a),$("#masslist > li").click(function(){PF.ui.panels.dig(),PF.forms.ajaxPostHandler("app/information/parishDetails",{idParish:this.id},PF.userActions.information.mass),PF.mapUI.flyToPin($(this).data("longitude"),$(this).data("latitude"),$(this).data("cid"))})}},information:{church:function(a){console.log(a),$(".panel__detail").html(a),$(".churchtitle").on("click",function(){PF.mapUI.flyToPin($(this).data("longitude"),$(this).data("latitude"),$(this).data("cid"))})},clergy:function(a){$(".panel__detail").html(a),$(".churchtitle").on("click",function(){PF.forms.ajaxPostHandler("app/information/parishDetails",{idParish:this.id},PF.userActions.information.mass),PF.mapUI.flyToPin($(this).data("longitude"),$(this).data("latitude"),$(this).data("cid"))})},mass:function(a){$(".panel__detail").html(a),$(".churchtitle").on("click",function(){PF.mapUI.flyToPin($(this).data("longitude"),$(this).data("latitude"),$(this).data("cid"))})}}};var PF=PF||{};PF.ui={},PF.ui.map={unfurl:function(){$("#map").hasClass("unfurled")?($(".unfurled").removeClass("unfurled"),$(".active").removeClass("active"),$(".icon-roll__down").addClass("active")):($("#map").addClass("unfurled"),$(".active").removeClass("active"),$(".icon-roll__up").addClass("active"))}},PF.ui.panels={panels:document.getElementsByClassName("panel"),panelsLocation:[],panelsWidth:[],currentState:function(){var a=!1;this.panelsLocation=[],this.panelsWidth=[];for(var t=0;t<this.panels.length;t++){var e=window.getComputedStyle(this.panels[t]).getPropertyValue("transform"),i=window.getComputedStyle(this.panels[t]).getPropertyValue("width"),n=Number(e.split("(")[1].split(")")[0].split(", ")[4]),r=Number(i.match(/(\d+)/g));0!==Math.abs(n%r)&&(a=!0),this.panelsLocation.push(n),this.panelsWidth.push(r)}if(a){var s;if(this.panelsLocation.indexOf(0)<0){var o=[],l;for(t=0;t<this.panelsLocation.length;t++)o.push(Math.abs(this.panelsLocation[t]));l=o.indexOf(Math.min.apply(Math,o)),s=l}else s=this.panelsLocation.indexOf(0);for(t=0;t<this.panelsLocation.length;t++){var p=t-s,c=p*this.panelsWidth[t],u="translate3d("+c+"px, 0, 0)";this.panels[t].style.transform=u}}},dig:function(){if(this.currentState(),this.panelsLocation[this.panelsLocation.length-1]>=this.panelsWidth[this.panelsWidth.length-1])for(var a=0;a<this.panels.length;a++){var t=this.panelsLocation[a]-this.panelsWidth[a],e="translate3d("+t+"px, 0, 0)";this.panels[a].style.transform=e}},climb:function(){if(this.currentState(),this.panelsLocation[0]<=-1*this.panelsWidth[0])for(var a=0;a<this.panels.length;a++){var t=this.panelsLocation[a]+this.panelsWidth[a],e="translate3d("+t+"px, 0, 0)";this.panels[a].style.transform=e}}},PF.ui.tabs={toggleTabs:function(){if("true"===$(this).attr("aria-selected"))$('[aria-selected="true"]').attr("aria-selected","false"),$.each($('[aria-selected="false"]'),function(){var a=$(this).attr("aria-controls");$("[id="+a+"]").attr("aria-hidden","true").slideUp(200)});else{$('[aria-selected="true"]').attr("aria-selected","false"),$(this).attr("aria-selected","true"),$.each($('[aria-selected="false"]'),function(){var a=$(this).attr("aria-controls");$("[id="+a+"]").attr("aria-hidden","true").slideUp(200)});var a=$(this).attr("aria-controls");$("[id="+a+"]").attr("aria-hidden","false").slideDown(200)}}};var PF=PF||{};L.mapbox.accessToken="pk.eyJ1IjoidHJhdmlzdy1yY2IiLCJhIjoiV1I2X0ZlQSJ9.HuDZt_-iESg9dg_PQvTFqA";var markersList=new Array;PF.mapUI={map:L.mapbox.map("map","travisw-rcb.j03n31d8"),featureLayer:new L.mapbox.featureLayer,mapUIinit:function(){PF.mapUI.featureLayer.loadURL("index.php/site/show_churches"),navigator.geolocation?PF.mapUI.map.locate():PF.mapUI.map.fitBounds(PF.mapUI.featureLayer.getBounds()),PF.mapUI.findCurrentLocation(),PF.mapUI.featureLayer.on("layeradd",function(a){marker=a.layer,markers=L.marker([marker.feature.properties.Latitude,marker.feature.properties.Longitude],{idChurch:""+marker.feature.properties.ChurchID,idParish:""+marker.feature.properties.idParish}).setIcon(L.icon({iconUrl:"http://a.tiles.mapbox.com/v4/marker/pin-m-place-of-worship+dd5252.png?access_token=pk.eyJ1IjoidHJhdmlzdy1yY2IiLCJhIjoiV1I2X0ZlQSJ9.HuDZt_-iESg9dg_PQvTFqA",iconSize:[30,70],iconAnchor:[15,35],popupAnchor:[0,-35]})),markersList.push(markers),markers.addTo(PF.mapUI.map),markers.bindPopup(PF.mapUI.loadInfoMarkers(marker.feature)),markers.on("click",function(){PF.mapUI.pinPopUPInformation(this.options)})}),PF.mapUI.featureLayer.on("click",function(a){PF.mapUI.map.panTo(a.layer.getLatLng())})},refresh:function(){PF.mapUI.map.invalidateSize()},findCurrentLocation:function(){PF.mapUI.map.on("locationfound",function(a){var t=L.marker(new L.LatLng(a.latlng.lat,a.latlng.lng),{icon:L.mapbox.marker.icon({"marker-color":"#4098d4","marker-symbol":"star"})}).bindPopup("Here I am!").addTo(PF.mapUI.map);try{PF.mapUI.map.fitBounds(PF.filter.findNearest(3,t).getBounds())}catch(a){PF.mapUI.map.setView(t.getLatLng(),13)}PF.mapUI.map.on("locationerror",function(){PF.mapUI.map.fitBounds(featureLayer.getBounds())})})},loadInfoMarkers:function(a){var t="<h3>"+a.properties.Church+"</h3>";return null!==a.properties.areaCode&&"Fax"!==a.properties.phone&&(phoneNumber='<p><a href="tel:1'+a.properties.areaCode+a.properties.phone+'"> ('+a.properties.areaCode+") "+a.properties.phone.replace(/\W/g,"").replace(/(...)/,"$1-")+"</a></p>"),null!==a.properties.Email&&(email='<p><a href="mailto:'+a.properties.Email+'">'+a.properties.Email+"</a></p>"),null!==a.properties.WebsiteUrl&&(website="<p><a href= http://"+a.properties.WebsiteUrl+' target="_blank">'+a.properties.WebsiteUrl+"</a></p>"),t+'<div class="churchContent">'+phoneNumber+email+website+"</div>"},mapMarkerWithPopUp:function(a,t,e,i,n,r){L.marker(new L.LatLng(a,t),{icon:L.mapbox.marker.icon({"marker-color":e,"marker-size":n,"marker-symbol":i})}).addTo(PF.mapUI.map)},openMarkerInfo:function(a){for(var t in markersList){markersList[t].options.idChurch==a&&markersList[t].openPopup()}},pinPopUPInformation:function(a){PF.ui.panels.dig(),setTimeout(function(){PF.ui.panels.dig()},400),PF.forms.ajaxPostHandler("app/information/parishDetails",{idParish:a.idParish},PF.userActions.information.church)},flyToPin:function(a,t,e){PF.mapUI.map.setView([t,a],17),PF.mapUI.openMarkerInfo(e)},boundsOnPID:function(a){longlatbounds=new Array;for(var t in markersList){var e=markersList[t].options.idParish;e==a&&(console.log(e),longlatbounds.push(markersList[t].getLatLng()),PF.mapUI.openMarkerInfo(markersList[t].options.idChurch))}bounds=L.latLngBounds(longlatbounds),PF.mapUI.map.fitBounds(bounds,{maxZoom:16,padding:[50,50]})}};var PF=PF||{};PF.ui={},PF.ui.map={unfurl:function(){$("#map").hasClass("unfurled")?($(".unfurled").removeClass("unfurled"),$(".active").removeClass("active"),$(".icon-roll__down").addClass("active")):($("#map").addClass("unfurled"),$(".active").removeClass("active"),$(".icon-roll__up").addClass("active"))}},PF.ui.panels={panels:document.getElementsByClassName("panel"),panelsLocation:[],panelsWidth:[],currentState:function(){var a=!1;this.panelsLocation=[],this.panelsWidth=[];for(var t=0;t<this.panels.length;t++){var e=window.getComputedStyle(this.panels[t]).getPropertyValue("transform"),i=window.getComputedStyle(this.panels[t]).getPropertyValue("width"),n=Number(e.split("(")[1].split(")")[0].split(", ")[4]),r=Number(i.match(/(\d+)/g));0!==Math.abs(n%r)&&(a=!0),this.panelsLocation.push(n),this.panelsWidth.push(r)}if(a){var s;if(this.panelsLocation.indexOf(0)<0){var o=[],l;for(t=0;t<this.panelsLocation.length;t++)o.push(Math.abs(this.panelsLocation[t]));l=o.indexOf(Math.min.apply(Math,o)),s=l}else s=this.panelsLocation.indexOf(0);for(t=0;t<this.panelsLocation.length;t++){var p=t-s,c=p*this.panelsWidth[t],u="translate3d("+c+"px, 0, 0)";this.panels[t].style.transform=u}}},dig:function(){if(this.currentState(),this.panelsLocation[this.panelsLocation.length-1]>=this.panelsWidth[this.panelsWidth.length-1])for(var a=0;a<this.panels.length;a++){var t=this.panelsLocation[a]-this.panelsWidth[a],e="translate3d("+t+"px, 0, 0)";this.panels[a].style.transform=e}},climb:function(){if(this.currentState(),this.panelsLocation[0]<=-1*this.panelsWidth[0])for(var a=0;a<this.panels.length;a++){var t=this.panelsLocation[a]+this.panelsWidth[a],e="translate3d("+t+"px, 0, 0)";this.panels[a].style.transform=e}}},PF.ui.tabs={toggleTabs:function(){if("true"===$(this).attr("aria-selected"))$('[aria-selected="true"]').attr("aria-selected","false"),$.each($('[aria-selected="false"]'),function(){var a=$(this).attr("aria-controls");$("[id="+a+"]").attr("aria-hidden","true").slideUp(200)});else{$('[aria-selected="true"]').attr("aria-selected","false"),$(this).attr("aria-selected","true"),$.each($('[aria-selected="false"]'),function(){var a=$(this).attr("aria-controls");$("[id="+a+"]").attr("aria-hidden","true").slideUp(200)});var a=$(this).attr("aria-controls");$("[id="+a+"]").attr("aria-hidden","false").slideDown(200)}}},PF.lonlat={centreOnMap:function(a){var t=new Array;geocoder.geocode({address:a},function(t,e){e==google.maps.GeocoderStatus.OK&&(PF.mapUI.mapMarkerWithPopUp(t[0].geometry.location.lat()+0,t[0].geometry.location.lng()+0,"#3ca0d3","religious-christian","large",a,"This is you"),PF.mapUI.map.panTo([t[0].geometry.location.lat()+0,t[0].geometry.location.lng()+0]))})}};var Detect={init:function(){this.OS=this.searchString(this.dataOS)},searchString:function(a){for(var t=0;t<a.length;t++){var e=a[t].string,i=a[t].prop;if(e){if(-1!=e.indexOf(a[t].subString))return a[t].identity}else if(i)return a[t].identity}},dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"macOS"},{string:navigator.userAgent,subString:"iPhone",identity:"iOS"},{string:navigator.userAgent,subString:"iPad",identity:"iOS"},{string:navigator.userAgent,subString:"iPod",identity:"iOS"},{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};$(function(){loadScript("https://maps.googleapis.com/maps/api/js?key=AIzaSyDy8HRqwTgiat99dbFR6mDGi1_BSgArnpo&callback=initialize",function(){console.log("Welcome to ParishFinder")}),PF.mapUI.mapUIinit(),baseUrl=document.location.origin,$(".spinner").hide(),$('input[type="submit"]').on("click",function(a){a.preventDefault(),PF.ui.panels.currentState(),postalCode=$('input[name="postalCode"]').val(),parishName=$('input[name="parishName"]').val(),clergyName=$('input[name="clergyName"]').val(),positionClergyID=$('select[name="clergyPosition"] option:selected').val(),cityID=$('select[name="city"]').val(),massTypeID=$('select[name="eventList"]').val(),StartTime=$("input[name = 'StartTime']").val(),DayOfWeek=$("input:checked").map(function(){return $(this).val()});var t=$(this),e=t.data("click");"function"==typeof PF.userActions[e]&&PF.userActions[e].call(this,a)}),window.onresize=function(){PF.ui.panels.currentState()},$('[role="tab"]').click(PF.ui.tabs.toggleTabs),$(".nav-dig").click(function(){0===$(".panel__list").children().length?(PF.ui.panels.dig(),setTimeout(function(){PF.ui.panels.dig()},400)):PF.ui.panels.dig()}),$(".nav-climb").click(function(){0===$(".panel__list").children().length?(PF.ui.panels.climb(),setTimeout(function(){PF.ui.panels.climb()},400)):PF.ui.panels.climb()}),$(".nav-roll__up").click(function(){PF.ui.map.unfurl()}),$(".nav-roll__down").click(function(){PF.ui.map.unfurl()})});